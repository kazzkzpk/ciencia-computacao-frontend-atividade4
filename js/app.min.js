document.addEventListener("DOMContentLoaded",(()=>{Theme.initTheme(),Router.initSPARouting(),Router.runPageSpecificLogic(window.location.pathname)}));const Router={mainContent:document.querySelector("main"),initSPARouting(){document.body.addEventListener("click",(e=>{const t=e.target.closest("a");if(!t)return;const r=t.getAttribute("href");r&&(r.endsWith(".html")||"/"===r)&&(e.preventDefault(),this.navigateTo(r))})),window.addEventListener("popstate",(e=>{e.state&&e.state.path&&this.loadPage(e.state.path,!1)})),history.replaceState({path:window.location.pathname},"",window.location.pathname)},navigateTo(e){this.loadPage(e,!0)},async loadPage(e,t){this.mainContent.style.opacity="0.5",this.mainContent.setAttribute("aria-busy","true");try{const r=await fetch(e);if(!r.ok)throw new Error("Falha ao carregar página.");const a=await r.text(),o=(new DOMParser).parseFromString(a,"text/html"),n=o.querySelector("main").innerHTML,i=o.querySelector("title").textContent;this.mainContent.innerHTML=n,document.title=i,this.mainContent.style.opacity="1",this.mainContent.setAttribute("aria-busy","false"),Theme.moveFocusToMainContent(this.mainContent),t&&history.pushState({path:e},i,e),this.runPageSpecificLogic(e)}catch(t){console.error("Falha ao carregar página:",t),window.location.href=e}},runPageSpecificLogic(e){Theme.initThemeToggleListener(),e.endsWith("/")||e.endsWith("index.html")||(e.endsWith("projetos.html")?Templates.loadProjectsFromJSON():e.endsWith("cadastro.html")&&Validation.initCadastroFormValidation())}},Templates={async loadProjectsFromJSON(){const e=document.querySelector("#nossos-projetos .row");if(e){e.innerHTML='<p role="status" aria-live="polite" style="text-align: center; width: 100%;">Carregando projetos...</p>';try{const t=await fetch("data/projetos.json");if(!t.ok)throw new Error("Falha ao carregar projetos.json");const r=await t.json();e.innerHTML=r.projects.map(this.renderProjectCard).join("")}catch(t){console.error("Falha ao carregar projetos.json:",t),e.innerHTML='<div class="alert alert-error" role="alert">Erro ao carregar projetos. Tente novamente mais tarde.</div>'}}},renderProjectCard(e){const t=e.tags.map((e=>`<span class="badge ${e.class}">${e.text}</span>`)).join("");return`\n        <article class="col-md-6 col-lg-4">\n            <div class="card">\n                <img src="${e.image}" alt="${e.alt}" class="card-img">\n                <div class="card-body">\n                    <div>${t}</div>\n                    <h3 class="card-title">${e.title}</h3>\n                    <p>${e.description}</p>\n                    <a href="cadastro.html" class="btn btn-primary">Quero Ajudar</a>\n                </div>\n            </div>\n        </article>\n        `}},Validation={initCadastroFormValidation(){const e=document.querySelector(".form-container");if(!e)return;const t=document.createElement("div");t.id="form-global-feedback",t.setAttribute("aria-live","assertive"),e.prepend(t),e.addEventListener("reset",(()=>{t.innerHTML="",e.querySelectorAll(".form-feedback").forEach((e=>e.remove()))})),e.addEventListener("submit",(r=>{r.preventDefault(),t.innerHTML="";if(this.validateForm(e))t.innerHTML='\n                    <div class="alert alert-success" role="alert">\n                        <strong>Obrigado!</strong> Seu cadastro foi enviado com sucesso.\n                    </div>',e.reset();else{t.innerHTML='\n                    <div class="alert alert-error" role="alert">\n                        <strong>Ops!</strong> Por favor, corrija os erros no formulário.\n                    </div>';const r=e.querySelector(".form-feedback");r&&r.scrollIntoView({behavior:"smooth",block:"center"})}}))},validateForm(e){let t=!0;e.querySelectorAll(".form-feedback").forEach((e=>e.remove()));return e.querySelectorAll("[required]").forEach((e=>{let r=null;if(""===e.value.trim())r="Este campo é obrigatório.";else if(e.pattern){new RegExp(e.pattern).test(e.value)||(r=e.title||"Formato inválido.")}else"email"!==e.type||this.isValidEmail(e.value)||(r="Por favor, insira um e-mail válido.");r&&(t=!1,this.showFieldError(e,r))})),t},showFieldError(e,t){const r=document.createElement("div");r.className="form-feedback",r.setAttribute("role","alert"),r.textContent=t,e.parentNode.appendChild(r)},isValidEmail:e=>/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(e)},Theme={initTheme(){const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e),this.initThemeToggleListener()},initThemeToggleListener(){const e=document.querySelector("#theme-toggle");if(!e)return;"dark"===document.documentElement.getAttribute("data-theme")?(e.innerHTML="&#9728;&#65039;",e.setAttribute("aria-label","Ativar modo claro")):(e.innerHTML="&#127769;",e.setAttribute("aria-label","Ativar modo escuro")),e.onclick=this.toggleTheme},toggleTheme(){const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),Theme.initThemeToggleListener()},moveFocusToMainContent(e){const t=e.querySelector("h1");t&&(t.setAttribute("tabindex","-1"),t.focus())}};